<?xml version="1.0" encoding="UTF-8"?>

<?import io.github.palexdev.materialfx.controls.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.*?>

<HBox xmlns="http://javafx.com/javafx/11.0.1"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.example.quanlytoanha.controller.ResidentDashboardController"
      prefWidth="1000.0" prefHeight="700.0"
      stylesheets="@styles/access_control_view_styles.css"
      style="-fx-font-family: 'DejaVu Sans'">

    <!-- Left Sidebar -->
    <VBox spacing="18.0"
          prefWidth="336.0"
          style="-fx-background-color: #21468B; -fx-padding: 42 24;">

        <!-- App Title -->
        <VBox alignment="CENTER" spacing="10.0" style="-fx-padding: 0 0 36 0;">
            <Label text="PLACEHOLDER"
                   style="-fx-font-size: 23px; -fx-font-weight: bold; -fx-text-fill: white; -fx-font-family: 'DejaVu Sans';"/>
            <Label text="PLACEHOLDER"
                   style="-fx-font-size: 14px; -fx-text-fill: rgba(255,255,255,0.7); -fx-font-family: 'DejaVu Sans';"/>
        </VBox>

        <!-- Navigation Section -->
        <VBox spacing="14.0">

            <!-- 1. Trang Chủ -->
            <MFXButton fx:id="homeButton"
                       onAction="#handleHomeButton"
                       text="Trang Chủ"
                       prefHeight="60.0"
                       maxWidth="Infinity"
                       style="-fx-background-color: rgba(255,255,255,0.15); -fx-background-radius: 12; -fx-text-fill: white; -fx-font-size: 17px; -fx-font-weight: 500; -fx-font-family: 'DejaVu Sans'; -fx-alignment: center-left; -fx-content-display: left;">
            </MFXButton>

            <!-- 2. Tra Cứu Hóa Đơn, Lịch Sử -->
            <MFXButton fx:id="invoiceHistoryButton"
                       onAction="#handleInvoiceHistoryButton"
                       text="Tra Cứu Hóa Đơn, Lịch Sử"
                       prefHeight="60.0"
                       maxWidth="Infinity"
                       style="-fx-background-color: rgba(255,255,255,0.15); -fx-background-radius: 12; -fx-text-fill: white; -fx-font-size: 17px; -fx-font-weight: 500; -fx-font-family: 'DejaVu Sans'; -fx-alignment: center-left;">
            </MFXButton>

            <!-- 3. Xem Thông Báo -->
            <MFXButton fx:id="notificationButton"
                       onAction="#handleNotificationButton"
                       text="Xem Thông Báo"
                       prefHeight="60.0"
                       maxWidth="Infinity"
                       style="-fx-background-color: rgba(255,255,255,0.15); -fx-background-radius: 12; -fx-text-fill: white; -fx-font-size: 17px; -fx-font-weight: 500; -fx-font-family: 'DejaVu Sans'; -fx-alignment: center-left;">
            </MFXButton>

            <!-- 4. Yêu Cầu Của Tôi -->
            <MFXButton fx:id="viewMyRequestsButton"
                       onAction="#handleViewMyRequestsButton"
                       text="Yêu Cầu Của Tôi"
                       prefHeight="60.0"
                       maxWidth="Infinity"
                       style="-fx-background-color: rgba(255,255,255,0.15); -fx-background-radius: 12; -fx-text-fill: white; -fx-font-size: 17px; -fx-font-weight: 500; -fx-font-family: 'DejaVu Sans'; -fx-alignment: center-left;">
            </MFXButton>

            <!-- 5. Tạo Phản Ánh -->
            <MFXButton fx:id="createRequestButton"
                       onAction="#handleCreateRequestButton"
                       text="Tạo Phản Ánh"
                       prefHeight="60.0"
                       maxWidth="Infinity"
                       style="-fx-background-color: rgba(255,255,255,0.15); -fx-background-radius: 12; -fx-text-fill: white; -fx-font-size: 17px; -fx-font-weight: 500; -fx-font-family: 'DejaVu Sans'; -fx-alignment: center-left;">
            </MFXButton>

            <!-- 6. Thay Đổi Thông Tin -->
            <MFXButton fx:id="profileChangeRequestButton"
                       onAction="#handleProfileChangeRequestButton"
                       text="Thay Đổi Thông Tin"
                       prefHeight="60.0"
                       maxWidth="Infinity"
                       style="-fx-background-color: rgba(255,255,255,0.15); -fx-background-radius: 12; -fx-text-fill: white; -fx-font-size: 17px; -fx-font-weight: 500; -fx-font-family: 'DejaVu Sans'; -fx-alignment: center-left;">
            </MFXButton>

            <!-- 7. Quản Lý Đăng Nhập -->
            <MFXButton fx:id="loginHistoryButton"
                       onAction="#handleLoginHistoryButton"
                       text="Quản Lý Đăng Nhập"
                       prefHeight="60.0"
                       maxWidth="Infinity"
                       style="-fx-background-color: rgba(255,255,255,0.15); -fx-background-radius: 12; -fx-text-fill: white; -fx-font-size: 17px; -fx-font-weight: 500; -fx-font-family: 'DejaVu Sans'; -fx-alignment: center-left;">
            </MFXButton>

        </VBox>

        <!-- Spacer -->
        <Region VBox.vgrow="ALWAYS"/>

        <!-- Logout Button with Icon -->
        <MFXButton fx:id="btnLogout"
                   onAction="#handleLogout"
                   prefHeight="60.0"
                   maxWidth="Infinity"
                   text="Đăng xuất"
                   buttonType="RAISED"
                   style="-fx-background-color: rgba(244,67,54,0.9); -fx-background-radius: 12; -fx-text-fill: white; -fx-font-size: 17px; -fx-font-weight: 600; -fx-font-family: 'DejaVu Sans'; -fx-alignment: center;">
        </MFXButton>

    </VBox>

    <!-- Main Content Area -->
    <VBox style="-fx-background-color: #f5f7fa; -fx-padding: 35;" VBox.vgrow="ALWAYS" HBox.hgrow="ALWAYS">

        <!-- Header Section -->
        <HBox alignment="CENTER_LEFT" spacing="12.0" style="-fx-padding: 0 0 30 0;">
            <VBox spacing="2.0">
                <Label fx:id="welcomeLabel" text="Xin chảo, Cư dân"
                       style="-fx-font-size: 30px; -fx-font-weight: bold; -fx-text-fill: #1a202c; -fx-font-family: 'DejaVu Sans';"/>
                <Label fx:id="pageTitle" text="Trang chủ"
                       style="-fx-font-size: 20px; -fx-text-fill: #718096; -fx-font-family: 'DejaVu Sans';"/>
            </VBox>
        </HBox>

        <!-- Dynamic Content Container -->
        <VBox fx:id="contentContainer" VBox.vgrow="ALWAYS">

            <!-- Default Dashboard Content (Overview Cards) -->
            <VBox fx:id="dashboardContent" spacing="30.0">
                <!-- Overview Cards -->
                <HBox spacing="20.0">

                    <!-- Outstanding Balance Card -->
                    <VBox alignment="CENTER" spacing="10.0"
                          prefWidth="310.0" prefHeight="180.0"
                          style="-fx-background-color: #667eea; -fx-background-radius: 14; -fx-effect: dropshadow(gaussian, rgba(102,126,234,0.4), 20, 0, 0, 5); -fx-padding: 20;">
                        <Label text="Số tiền hiện tại"
                               style="-fx-font-size: 20px; -fx-text-fill: white; -fx-font-weight: 500; -fx-font-family: 'DejaVu Sans';"/>
                        <Label fx:id="debtAmountLabel" text="0 VND"
                               style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: white; -fx-font-family: 'DejaVu Sans';"/>
                    </VBox>

                    <!-- Monthly Payment Card -->
                    <VBox alignment="CENTER" spacing="10.0"
                          prefWidth="310.0" prefHeight="180.0"
                          style="-fx-background-color: #f093fb; -fx-background-radius: 14; -fx-effect: dropshadow(gaussian, rgba(240,147,251,0.4), 20, 0, 0, 5); -fx-padding: 20;">
                        <Label text="Số tiền trả tháng này"
                               style="-fx-font-size: 20px; -fx-text-fill: white; -fx-font-weight: 500; -fx-font-family: 'DejaVu Sans';"/>
                        <Label fx:id="paidAmountLabel" text="0 VND"
                               style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: white; -fx-font-family: 'DejaVu Sans';"/>
                    </VBox>

                    <!-- New Messages Card -->
                    <VBox alignment="CENTER" spacing="10.0"
                          prefWidth="310.0" prefHeight="180.0"
                          style="-fx-background-color: #4facfe; -fx-background-radius: 14; -fx-effect: dropshadow(gaussian, rgba(79,172,254,0.4), 20, 0, 0, 5); -fx-padding: 20;">
                        <Label text="Các thông báo chưa đọc"
                               style="-fx-font-size: 20px; -fx-text-fill: white; -fx-font-weight: 500; -fx-font-family: 'DejaVu Sans';"/>
                        <Label fx:id="notificationCountLabel" text="0"
                               style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: white; -fx-font-family: 'DejaVu Sans';"/>
                    </VBox>

                </HBox>

                <!--Graph of service -->
                <VBox spacing="20.0">
                    <!-- Service Consumption Charts Section -->
                    <VBox spacing="18.0"
                          style="-fx-background-color: white; -fx-background-radius: 14; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.06), 12, 0, 0, 2); -fx-padding: 25;">
                        <!-- Section Title -->
                        <HBox alignment="CENTER_LEFT" spacing="10.0">
                            <Label text="Biểu đồ tiêu thụ dịch vụ"
                                   style="-fx-font-size: 19px; -fx-font-weight: bold; -fx-text-fill: #1a202c; -fx-font-family: 'DejaVu Sans';"/>
                            <Label fx:id="chartPeriodLabel" text="Tháng hiện tại"
                                   style="-fx-font-size: 12px; -fx-text-fill: #a0aec0; -fx-padding: 4 12; -fx-background-color: #e2e8f0; -fx-background-radius: 12; -fx-font-family: 'DejaVu Sans';"/>
                        </HBox>

                        <!-- Chart Controls -->
                        <HBox spacing="10.0" alignment="CENTER_LEFT">
                            <MFXButton fx:id="currentMonthBtn"
                                       onAction="#showCurrentMonthChart"
                                       text="Tháng này"
                                       prefHeight="35.0"
                                       style="-fx-background-color: #667eea; -fx-background-radius: 8; -fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: 500; -fx-font-family: 'DejaVu Sans';"/>
                            <MFXButton fx:id="trendBtn"
                                       onAction="#showTrendChart"
                                       text="Xu hướng 6 tháng"
                                       prefHeight="35.0"
                                       style="-fx-background-color: rgba(102,126,234,0.3); -fx-background-radius: 8; -fx-text-fill: #667eea; -fx-font-size: 13px; -fx-font-weight: 500; -fx-font-family: 'DejaVu Sans';"/>
                        </HBox>

                        <!-- Charts Container -->
                        <VBox fx:id="chartsContainer" prefHeight="350.0" alignment="CENTER" spacing="0.0">

                            <!-- Current Month Pie Chart (Default) -->
                            <VBox fx:id="pieChartContainer" spacing="15.0" alignment="CENTER">
                                <PieChart fx:id="serviceConsumptionChart"
                                          prefHeight="280.0"
                                          minHeight="280.0"
                                          maxHeight="280.0"
                                          style="-fx-background-color: transparent; -fx-padding: 0;" />
                                <Label fx:id="totalAmountLabel"
                                       text="Tổng chi phí: 0 VND"
                                       style="-fx-font-size: 18px; -fx-font-weight: 600; -fx-text-fill: #1a202c; -fx-font-family: 'DejaVu Sans';"/>
                            </VBox>

                            <!-- 6-Month Trend Line Chart (Hidden by default) -->
                            <VBox fx:id="lineChartContainer" spacing="0.0" alignment="CENTER" VBox.vgrow="ALWAYS" visible="false">
                                <LineChart fx:id="consumptionTrendChart"
                                           prefHeight="280.0"
                                           minHeight="280.0"
                                           VBox.vgrow="ALWAYS"
                                           animated="true"
                                           style="-fx-background-color: transparent; -fx-padding: 0;">
                                    <xAxis>
                                        <CategoryAxis fx:id="monthAxis" label="Tháng" side="BOTTOM"/>
                                    </xAxis>
                                    <yAxis>
                                        <NumberAxis fx:id="amountAxis" label="Số tiền (VND)" side="LEFT"/>
                                    </yAxis>
                                </LineChart>
                            </VBox>
                            <!-- No Data Message (Hidden by default) -->
                            <VBox fx:id="noDataContainer" spacing="10.0" alignment="CENTER" visible="false">
                                <Label text="Không có dữ liệu"
                                       style="-fx-font-size: 16px; -fx-text-fill: #a0aec0; -fx-font-family: 'DejaVu Sans';"/>
                                <Label text="Chưa có hóa đơn nào cho thời kỳ này"
                                       style="-fx-font-size: 12px; -fx-text-fill: #a0aec0; -fx-font-family: 'DejaVu Sans';"/>
                            </VBox>

                        </VBox>
                    </VBox>
                </VBox>

                <!-- Recent Activity Section -->
                <VBox spacing="18.0" VBox.vgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="10.0">
                        <Label text="Hoạt động gần đây"
                               style="-fx-font-size: 19px; -fx-font-weight: bold; -fx-text-fill: #1a202c; -fx-font-family: 'DejaVu Sans';"/>
                        <Label text="7 ngày vừa qua"
                               style="-fx-font-size: 12px; -fx-text-fill: #a0aec0; -fx-padding: 4 12; -fx-background-color: #e2e8f0; -fx-background-radius: 12; -fx-font-family: 'DejaVu Sans';"/>
                    </HBox>

                    <!-- Activity List Container -->
                    <ScrollPane fitToWidth="true"
                                style="-fx-background-color: transparent; -fx-background: transparent;">
                        <VBox spacing="0"
                              style="-fx-background-color: white; -fx-background-radius: 14; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.06), 12, 0, 0, 2); -fx-padding: 0;">

                            <!-- Activity Item 1 -->
                            <HBox alignment="CENTER_LEFT" spacing="15.0"
                                  style="-fx-padding: 20; -fx-background-color: transparent;">
                                <VBox alignment="CENTER" prefWidth="50.0" prefHeight="50.0"
                                      style="-fx-background-color: #d4edda; -fx-background-radius: 12;">
                                </VBox>
                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                    <Label text="December 2023 Invoice"
                                           style="-fx-font-size: 15px; -fx-font-weight: 600; -fx-text-fill: #1a202c; -fx-font-family: 'DejaVu Sans';"/>
                                    <Label text="Payment completed successfully"
                                           style="-fx-font-size: 12px; -fx-text-fill: #718096; -fx-font-family: 'DejaVu Sans';"/>
                                </VBox>
                                <VBox alignment="TOP_RIGHT" spacing="4.0">
                                    <Label text="2,500,000 VND"
                                           style="-fx-font-size: 14px; -fx-font-weight: 600; -fx-text-fill: #10b981; -fx-font-family: 'DejaVu Sans';"/>
                                    <Label text="Dec 15"
                                           style="-fx-font-size: 11px; -fx-text-fill: #a0aec0; -fx-font-family: 'DejaVu Sans';"/>
                                </VBox>
                            </HBox>

                            <Separator style="-fx-background-color: #f1f3f5; -fx-padding: 0 20;"/>

                            <!-- Activity Item 2 -->
                            <HBox alignment="CENTER_LEFT" spacing="15.0"
                                  style="-fx-padding: 20; -fx-background-color: transparent;">
                                <VBox alignment="CENTER" prefWidth="50.0" prefHeight="50.0"
                                      style="-fx-background-color: #fff3cd; -fx-background-radius: 12;">
                                </VBox>
                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                    <Label text="Elevator Maintenance Notice"
                                           style="-fx-font-size: 15px; -fx-font-weight: 600; -fx-text-fill: #1a202c; -fx-font-family: 'DejaVu Sans';"/>
                                    <Label text="Scheduled maintenance on Dec 20, 8AM-12PM"
                                           style="-fx-font-size: 12px; -fx-text-fill: #718096; -fx-font-family: 'DejaVu Sans';"/>
                                </VBox>
                                <Label text="Dec 10"
                                       style="-fx-font-size: 11px; -fx-text-fill: #a0aec0; -fx-font-family: 'DejaVu Sans';"/>
                            </HBox>

                            <Separator style="-fx-background-color: #f1f3f5; -fx-padding: 0 20;"/>

                            <!-- Activity Item 3 -->
                            <HBox alignment="CENTER_LEFT" spacing="15.0"
                                  style="-fx-padding: 20; -fx-background-color: transparent;">
                                <VBox alignment="CENTER" prefWidth="50.0" prefHeight="50.0"
                                      style="-fx-background-color: #cfe2ff; -fx-background-radius: 12;">
                                </VBox>
                                <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                    <Label text="System Login Detected"
                                           style="-fx-font-size: 15px; -fx-font-weight: 600; -fx-text-fill: #1a202c; -fx-font-family: 'DejaVu Sans';"/>
                                    <Label text="Access from IP: 192.168.1.100"
                                           style="-fx-font-size: 12px; -fx-text-fill: #718096; -fx-font-family: 'DejaVu Sans';"/>
                                </VBox>
                                <Label text="Dec 08"
                                       style="-fx-font-size: 11px; -fx-text-fill: #a0aec0; -fx-font-family: 'DejaVu Sans';"/>
                            </HBox>

                        </VBox>
                    </ScrollPane>

                </VBox>
            </VBox>

        </VBox>

    </VBox>

</HBox>